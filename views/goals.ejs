<%- include('templates/header'); %>

<!-- Button to trigger the modal -->
<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addGoalModal">
    Add Goal
</button>

<!-- Modal -->
<div class="modal fade" id="addGoalModal" tabindex="-1" role="dialog" aria-labelledby="addGoalModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmationModalLabel">Confirm Deletion</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this goal?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" id="confirmDelete" class="btn btn-danger">Delete</button>
            </div>
        </div>
    </div>
</div>
<!-- End Confirmation Modal -->

<div class="list-group me-3 mt-3">
  <% if (result && result.goal && result.goal.length > 0) { %>
    <% result.goal.forEach((item, index) => { %>
      <label class="list-group-item">
        <form id="deleteGoalForm<%= index %>" action="/deletegoal" method="post">
          <input type="hidden" name="goalIndex" value="<%= index %>">
          <button type="submit" class="close" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          <strong>Complete <%= item[0] %><%= item[1] %> of <%= item[2] %>:</strong>
          <%= item[3] %><%= item[1] %>/<%= item[0] %><%= item[1] %> completed.
        </form>
        <!-- Contribute Button -->
    <label class="list-group-item">
      <form id="contributeForm" action="/contribute" method="post">
        <input type="hidden" name="goalIndex" value="<%= index %>">
        <input name="quantity" type="text" class="form-control" id="quantity" placeholder="Amount Complete" required>
        <button type="submit" class="btn btn-primary">Contribute</button>
      </form>
    </label>
      </label>
    <% }); %>
  <% } else { %>
    <label class="list-group-item">No goals found.</label>
  <% } %>
</div>



<%- include('templates/footer'); %>

<!-- JavaScript for delete action -->
<script>
    $(document).ready(function() {
        // Handle delete action when the "Delete" button in the confirmation modal is clicked
        $('#confirmDelete').on('click', function() {
            var goalIndex = $('#confirmationModal').data('goal-index');
            $('#deleteGoalForm' + goalIndex).submit();
        });

        // Store the goal index when the confirmation modal is shown
        $('#confirmationModal').on('show.bs.modal', function(event) {
            var button = $(event.relatedTarget); // Button that triggered the modal
            var goalIndex = button.closest('form').find('input[name="goalIndex"]').val(); // Get the goal index from the form
            $(this).data('goal-index', goalIndex); // Store the goal index in the modal data
        });
    });
</script>


    

    